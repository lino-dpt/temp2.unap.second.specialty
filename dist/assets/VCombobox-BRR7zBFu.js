import{m as Ve,u as pe,a as Ce,b as we}from"./VSelect-DZIe-0_3.js";import{m as ke,V as Q}from"./VTextField-BMsZ9TUb.js";import{C as Se,D as Fe,E as Ie,G as De,H as Pe,r as N,I as D,J as X,K as x,L as _e,M as Re,ag as O,N as P,O as Y,P as Ae,Q as Te,b as o,F as L,R as Me,S as I,x as Ee,y as Z,T as Ne,q as ee,U as Oe,W as Le,i as Ke,X as Ue,Y as Be,Z as je,ah as He}from"./index-Cpba7QVi.js";import{m as qe,u as ze}from"./filter-C0E0RAw_.js";import{u as Ge}from"./VInput-DEMVTei1.js";import{a as We}from"./VChip-CJF47lsE.js";var tl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function al(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function $e(e,b,_){if(b==null)return e;if(Array.isArray(b))throw new Error("Multiple matches is not implemented");return typeof b=="number"&&~b?o(L,null,[o("span",{class:"v-combobox__unmask"},[e.substr(0,b)]),o("span",{class:"v-combobox__mask"},[e.substr(b,_)]),o("span",{class:"v-combobox__unmask"},[e.substr(b+_)])]):e}const Je=Se({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...qe({filterKeys:["title"]}),...Ve({hideNoData:!0,returnObject:!0}),...Fe(ke({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ie({transition:!1})},"VCombobox"),nl=De()({name:"VCombobox",props:Je(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,b){var W;let{emit:_,slots:n}=b;const{t:K}=Pe(),V=N(),h=D(!1),p=D(!0),R=D(!1),q=N(),z=N(),U=X(e,"menu"),r=x({get:()=>U.value,set:l=>{var a;U.value&&!l&&((a=q.value)!=null&&a.Î¨openChildren)||(U.value=l)}}),i=D(-1);let B=!1;const le=x(()=>{var l;return(l=V.value)==null?void 0:l.color}),G=x(()=>r.value?e.closeText:e.openText),{items:te,transformIn:ae,transformOut:ne}=_e(e),{textColorClasses:ue,textColorStyles:oe}=Re(le),u=X(e,"modelValue",[],l=>ae(je(l)),l=>{const a=ne(l);return e.multiple?a:a[0]??null}),S=Ge(),F=D(e.multiple?"":((W=u.value[0])==null?void 0:W.title)??""),c=x({get:()=>F.value,set:l=>{var a;if(F.value=l??"",e.multiple||(u.value=[O(e,l)]),l&&e.multiple&&((a=e.delimiters)!=null&&a.length)){const s=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));s.length>1&&(s.forEach(d=>{d=d.trim(),d&&g(O(e,d))}),F.value="")}l||(i.value=-1),p.value=!l}}),ie=x(()=>typeof e.counterValue=="function"?e.counterValue(u.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?u.value.length:c.value.length);P(F,l=>{B?Y(()=>B=!1):h.value&&!r.value&&(r.value=!0),_("update:search",l)}),P(u,l=>{var a;e.multiple||(F.value=((a=l[0])==null?void 0:a.title)??"")});const{filteredItems:A,getMatches:se}=ze(e,te,()=>p.value?"":c.value),m=x(()=>e.hideSelected?A.value.filter(l=>!u.value.some(a=>a.value===l.value)):A.value),re=x(()=>u.value.map(l=>l.value)),T=x(()=>{var a;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&c.value===((a=m.value[0])==null?void 0:a.title))&&m.value.length>0&&!p.value&&!R.value}),j=x(()=>e.hideNoData&&!m.value.length||e.readonly||(S==null?void 0:S.isReadonly.value)),H=N(),{onListScroll:ce,onListKeydown:ve}=pe(H,V);function de(l){B=!0,e.openOnClear&&(r.value=!0)}function fe(){j.value||(r.value=!0)}function me(l){j.value||(h.value&&(l.preventDefault(),l.stopPropagation()),r.value=!r.value)}function be(l){var d;if(He(l)||e.readonly||S!=null&&S.isReadonly.value)return;const a=V.value.selectionStart,s=u.value.length;if((i.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(T.value&&["Enter","Tab"].includes(l.key)&&g(A.value[0]),p.value=!0),l.key==="ArrowDown"&&T.value&&((d=H.value)==null||d.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(i.value<0){l.key==="Backspace"&&!c.value&&(i.value=s-1);return}const t=i.value,v=u.value[i.value];v&&!v.props.disabled&&g(v,!1),i.value=t>=s-1?s-2:t}if(l.key==="ArrowLeft"){if(i.value<0&&a>0)return;const t=i.value>-1?i.value-1:s-1;u.value[t]?i.value=t:(i.value=-1,V.value.setSelectionRange(c.value.length,c.value.length))}if(l.key==="ArrowRight"){if(i.value<0)return;const t=i.value+1;u.value[t]?i.value=t:(i.value=-1,V.value.setSelectionRange(0,0))}l.key==="Enter"&&c.value&&(g(O(e,c.value)),c.value="")}}function he(){var l;h.value&&(p.value=!0,(l=V.value)==null||l.focus())}function g(l){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.multiple){const s=u.value.findIndex(t=>e.valueComparator(t.value,l.value)),d=a??!~s;if(~s){const t=d?[...u.value,l]:[...u.value];t.splice(s,1),u.value=t}else d&&(u.value=[...u.value,l]);e.clearOnSelect&&(c.value="")}else{const s=a!==!1;u.value=s?[l]:[],F.value=s?l.title:"",Y(()=>{r.value=!1,p.value=!0})}}function ge(l){h.value=!0,setTimeout(()=>{R.value=!0})}function ye(l){R.value=!1}function xe(l){(l==null||l===""&&!e.multiple)&&(u.value=[])}return P(h,(l,a)=>{l||l===a||(i.value=-1,r.value=!1,T.value&&!R.value&&!u.value.some(s=>{let{value:d}=s;return d===m.value[0].value})?g(m.value[0]):e.multiple&&c.value&&g(O(e,c.value)))}),P(r,()=>{if(!e.hideSelected&&r.value&&u.value.length){const l=m.value.findIndex(a=>u.value.some(s=>e.valueComparator(s.value,a.value)));Ae&&window.requestAnimationFrame(()=>{var a;l>=0&&((a=z.value)==null||a.scrollToIndex(l))})}}),P(m,(l,a)=>{h.value&&(!l.length&&e.hideNoData&&(r.value=!1),!a.length&&l.length&&(r.value=!0))}),Te(()=>{const l=!!(e.chips||n.chip),a=!!(!e.hideNoData||m.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),s=u.value.length>0,d=Q.filterProps(e);return o(Q,I({ref:V},d,{modelValue:c.value,"onUpdate:modelValue":[t=>c.value=t,xe],focused:h.value,"onUpdate:focused":t=>h.value=t,validationValue:u.externalValue,counterValue:ie.value,dirty:s,class:["v-combobox",{"v-combobox--active-menu":r.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!n.selection,"v-combobox--selecting-index":i.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:e.readonly,placeholder:s?void 0:e.placeholder,"onClick:clear":de,"onMousedown:control":fe,onKeydown:be}),{...n,default:()=>o(L,null,[o(Me,I({ref:q,modelValue:r.value,"onUpdate:modelValue":t=>r.value=t,activator:"parent",contentClass:"v-combobox__content",disabled:j.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:he},e.menuProps),{default:()=>[a&&o(Ee,I({ref:H,selected:re.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:t=>t.preventDefault(),onKeydown:ve,onFocusin:ge,onFocusout:ye,onScrollPassive:ce,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},e.listProps),{default:()=>{var t,v,y;return[(t=n["prepend-item"])==null?void 0:t.call(n),!m.value.length&&!e.hideNoData&&(((v=n["no-data"])==null?void 0:v.call(n))??o(Z,{title:K(e.noDataText)},null)),o(Ce,{ref:z,renderless:!0,items:m.value},{default:C=>{var J;let{item:f,index:w,itemRef:k}=C;const $=I(f.props,{ref:k,key:w,active:T.value&&w===0?!0:void 0,onClick:()=>g(f,null)});return((J=n.item)==null?void 0:J.call(n,{item:f,index:w,props:$}))??o(Z,I($,{role:"option"}),{prepend:M=>{let{isSelected:E}=M;return o(L,null,[e.multiple&&!e.hideSelected?o(we,{key:f.value,modelValue:E,ripple:!1,tabindex:"-1"},null):void 0,f.props.prependAvatar&&o(Ne,{image:f.props.prependAvatar},null),f.props.prependIcon&&o(ee,{icon:f.props.prependIcon},null)])},title:()=>{var M,E;return p.value?f.title:$e(f.title,(M=se(f))==null?void 0:M.title,((E=c.value)==null?void 0:E.length)??0)}})}}),(y=n["append-item"])==null?void 0:y.call(n)]}})]}),u.value.map((t,v)=>{function y(k){k.stopPropagation(),k.preventDefault(),g(t,!1)}const C={"onClick:close":y,onMousedown(k){k.preventDefault(),k.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},f=l?!!n.chip:!!n.selection,w=f?Oe(l?n.chip({item:t,index:v,props:C}):n.selection({item:t,index:v})):void 0;if(!(f&&!w))return o("div",{key:t.value,class:["v-combobox__selection",v===i.value&&["v-combobox__selection--selected",ue.value]],style:v===i.value?oe.value:{}},[l?n.chip?o(Le,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:t.title}}},{default:()=>[w]}):o(We,I({key:"chip",closable:e.closableChips,size:"small",text:t.title,disabled:t.props.disabled},C),null):w??o("span",{class:"v-combobox__selection-text"},[t.title,e.multiple&&v<u.value.length-1&&o("span",{class:"v-combobox__selection-comma"},[Ke(",")])])])})]),"append-inner":function(){var C;for(var t=arguments.length,v=new Array(t),y=0;y<t;y++)v[y]=arguments[y];return o(L,null,[(C=n["append-inner"])==null?void 0:C.call(n,...v),(!e.hideNoData||e.items.length)&&e.menuIcon?o(ee,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:me,onClick:Ue,"aria-label":K(G.value),title:K(G.value)},null):void 0])}})}),Be({isFocused:h,isPristine:p,menu:r,search:c,selectionIndex:i,filteredItems:A,select:g},V)}});export{nl as V,tl as c,al as g};
